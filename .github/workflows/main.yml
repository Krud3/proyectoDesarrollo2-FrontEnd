name: Node.js CI

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: front-end-gallery-gavel

    steps:
    - uses: actions/checkout@v3

    - name: Build the Docker container
      run: docker build . --file Dockerfile.testing -t my-node-app

    - name: Run npm test
      run: docker run my-node-app npm run test -- --run

    - name: Push changes
      if: success()  # Esta condici√≥n asegura que los siguientes pasos solo se ejecutan si npm run test fue exitoso
      run: echo "Tests passed. Pushing to main."
